<% provide :title, 'Pain Points' %>
<% provide :heading, "#{current_user.first_name ? current_user.first_name + "'" : ""} Pain Points" %>

<div class="row">
<div class="col-xs-12 button-heading">
  <%= link_to new_pain_point_path, class: 'btn btn-primary' do %>
    <span class="glyphicon glyphicon-plus"></span>
    New Pain point
  <% end %>
</div>
</div>

<div class="col-xs-12">
<div class="table-responsive">
  <table class="table table-striped table-bordered table-hover">
    <thead>
      <tr>
        <th>Date</th>
        <th>Magnitude</th>
        <th>Activity</th>
        <th>Location</th>
        <th>Notes</th>
        <th></th>
        <th></th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      <%= content_tag_for(:tr, @pain_points) do |pain_point| %>
        <td><%= date_format pain_point.date %></td>
        <td><%= link_to pain_point.magnitude, pain_points_path(filter: {magnitude: pain_point.magnitude}) %></td>
        <td><%= link_to pain_point.activity ? pain_point.activity.name : 'None', pain_points_path(filter:
                                                                                                      {activity_id:
                                                                                                           pain_point
                                                                                                               .activity_id})
        %></td>
        <td><%= pain_point.location_id %></td>
        <td><%= pain_point.notes %></td>
        <td><%= link_to 'Show', pain_point %></td>
        <td><%= link_to 'Edit', edit_pain_point_path(pain_point) %></td>
        <td><%= link_to 'Destroy', pain_point, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      <% end %>
    </tbody>
  </table>
</div>
</div>

<div class="col-xs-12">
  <%# Need to "reorder" or, remove the order clause before aggregating because pg sql is no bueno %>
  <%= line_chart @pain_points.reorder('').group_by_day(:date).sum(:magnitude) %>
</div>
