<% provide :title, 'Pain Points' %>
<% provide :active, 'Pain Points' %>
<% provide :heading, "#{current_user.first_name ? current_user.first_name + "'" : ""} Pain Points" %>

<div class="row">

  <%= render 'index' %>
  <div class="col-xs-12">
    <div class="form-group form-inline">
      <%= form_tag(pain_points_upload_path, method: :post, multipart: true) do %>
          <%= submit_tag('Upload CSV', class: 'btn btn-primary') %>
        <%= file_field_tag(:file, class: 'form-control') %>
      <% end %>
    </div>
  </div>

  <div class="col-xs-12">
    <%= link_to 'Cleanup Duplicates', cleanup_path %>
  </div>

  <%if !@pain_points.is_a?(Array) %>
      <div class="col-xs-12">
        <h2><%=filter_title_for(@pain_points.first, @filter)%> Pain Over Time</h2>
        <% total_data = @pain_points.group(:date).sum(:magnitude) %>
        <%= chart_or_banner total_data, line_chart(total_data) %>
      </div>
  <% end %>

  <% [:activity, :location].each do |term| %>
  <div class="col-xs-12 col-sm-6"%>
    <h2>Pain by <%=term.to_s.titleize%></h2>
    <% term_data = @pain_points.includes(term).group("#{term.to_s.pluralize}.name").sum(:magnitude) %>
    <%= chart_or_banner term_data, pie_chart(term_data, library: PainTracker::PIE_CHART_NO_LEGEND) %>
  </div>
  <% end %>
</div>
